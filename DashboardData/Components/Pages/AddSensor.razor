@page "/add-sensor"
@using DashboardData.Models
@using DashboardData.Services
@inject ISensorService SensorService
@inject NavigationManager NavManager

<h3>Ajouter un nouveau capteur</h3>

<EditForm Model="@newSensor" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />

    <div class="form-group mb-3">
        <label for="name">Nom du capteur :</label>
        <InputText id="name" class="form-control" @bind-Value="newSensor.Name" />
        <ValidationMessage For="@(() => newSensor.Name)" />
    </div>

    <div class="form-group mb-3">
        <label for="value">Valeur :</label>
        <InputNumber id="value" class="form-control" @bind-Value="newSensor.Value" />
        <ValidationMessage For="@(() => newSensor.Value)" />
    </div>

    <button type="submit" class="btn btn-success" disabled="@_isSubmitting">
        @(_isSubmitting ? "Ajout en cours..." : "Ajouter le capteur")
    </button>

    <button type="button" class="btn btn-secondary ms-2" @onclick="Cancel">
        Annuler
    </button>
</EditForm>

@code {
    private SensorData newSensor = new();
    private bool _isSubmitting = false;

    private async Task HandleValidSubmit()
    {
        _isSubmitting = true;
        SensorService.AddSensor(newSensor);
        await Task.Delay(500);
        NavManager.NavigateTo("/dashboard");
        _isSubmitting = false;
    }

    private void Cancel()
    {
        NavManager.NavigateTo("/dashboard");
    }
}